# 生成扩散方法：高维联合分布的分解与重建

## 问题定义：人口画像的本质是高维联合分布重建

人口画像并非若干“单一属性”的拼接，而是一个高维联合概率分布的重建问题：

> \(P(\text{年龄},\text{性别},\text{受教育},\text{职业},\text{收入},\text{居住地/建筑物},\text{时间})\)

难点不在于某一维的边际分布是否拟合得足够好，而在于属性之间存在强耦合与结构性约束：例如“收入–职业–居住地”的联动、“家庭结构–个体属性”的层级一致性，以及大量稀有但真实存在的长尾组合。随着属性维度增加，联合空间规模指数增长，基于交叉表或显式枚举的估计迅速走向稀疏与不可解。

因此，方法层面的关键科学问题可锋利化为一句话：**如何在不枚举高维组合空间的前提下，重建真实人口联合分布的关联结构，并在生成过程中同时满足宏观统计约束与微观逻辑可行性。**

---

## 现有技术路线的结构性局限：解决“边际”不等于重建“联合结构”

现有人口合成主流路线（SR/IPF、CO、以及部分ML/深度学习）在工程上有效，但其局限来自问题本身的高维结构，而非参数未调好。

**（1）SR / IPF 系列：依赖边际拟合，隐含弱关联假设**  
IPF/IPU 等方法擅长将种子样本“调权”以匹配区域边际分布，但当属性维度升高时，常需要默认或近似默认属性条件独立，导致关键耦合关系被抹平（例如高学历–高收入–高职业地位的联动）。更本质的是：当某些属性组合在种子支持集中缺失（sampling zeros）时，调权无法“凭空创造”新的合法组合。

**（2）CO（组合优化）：可强约束但受限于候选库覆盖度**  
组合优化可以把“拟合宏观统计 + 满足规则”写成优化问题并求可行解，但其解空间由候选样本库定义；候选库未覆盖的罕见组合在优化框架下同样无解，且随着约束增多，搜索复杂度与不可行风险显著上升。

**（3）ML/判别式或单属性预测：难以保证多属性联合一致性**  
对单一属性的预测与插补可提升局部精度，却难以从机制上保证多属性联合的一致性与层级可行性：模型可能分别把每一维“预测对”，但组合到一起仍出现结构性零或家庭–个体矛盾。

这些局限共同指向同一个根因：**目标不是拟合若干边际，而是重建“联合分布的几何结构 + 约束下的可行域”。**

---

## 扩散模型的独特优势：把“一次性高维估计”分解为“逐步去噪”的分布塑形

换言之，上述局限共同指向一个需求：需要一种能够直接建模联合分布关联结构的生成机制，而不是将其拆解为边际分布的乘积；并且约束应当在生成过程中起作用。扩散模型为此提供了一条新路径。

扩散模型提供了一种与上述根因同构的解法：它不要求直接在高维离散空间一次性估计联合分布，而是通过“加噪→去噪”的可控过程，把重建任务分解为一系列难度更低的局部修正。

其直观机制可以理解为：

- **前向加噪**逐步抹平样本中的细节与相关结构，使分布趋向简单（高不确定度、弱结构）。
- **反向去噪**从简单分布出发，分阶段恢复真实人口的相关结构；每一步只需回答“在当前不确定度水平下，样本应沿什么方向更像真实人口”。

这意味着扩散模型能够直接学习联合分布的“形状”（关联结构与高概率区域），而不是把联合分布拆成若干边际的乘积；同时，逐步去噪把高维估计拆解为多次低难度更新，从而缓解高维稀疏下“一步到位”估计的不稳定；进一步地，宏观统计与场景条件可以在去噪过程中持续注入（guidance/conditioning），使“满足约束”成为生成动力学的一部分，而非生成后再筛选或事后修补。

更重要的是，这种“逐层、逐尺度”的生成动力学与课题提出的**物理启发（多层次扩散）**在方法论上形成呼应：宏观到微观、区域到建筑、静态到动态，都可以被表述为“逐层分辨率提升”的重建过程。

---

## 在本课题中的落地：数据–方法–场景闭环

扩散模型本体解决“如何学习联合分布并生成多样样本”，而人口画像的落地还必须同时回答“如何可控、如何可行、如何可验”。因此，本课题将生成过程组织为一个闭环：**多源条件 → 受控生成 → 规则可行 → 宏观一致 → 时空验证**。

### 生成对象与表示：混合类型表格扩散 + 分层结构

面向人口画像，变量同时包含离散属性（年龄段、职业等）、连续属性（收入等）与层级变量（户–人、建筑物–区域、时间段）。对应地，生成模型采用“表格扩散（Tabular Diffusion）”作为核心框架，并按变量类型设计扩散过程：

- **混合类型表格扩散**：连续列采用连续扩散，离散列采用离散扩散或“嵌入–映射”策略，在同一去噪网络中联合学习相关结构。[^tabular-diff]  
- **分层/级联生成**：先生成稳定的“骨架”（如区域/建筑层面的容量与人群结构、或家庭层属性），再在条件约束下生成个体成员属性与时间属性，用“由粗到细”的层级化流程降低一次性联合生成的难度与不一致风险。

上述表示使“高维联合分布”被转化为一个可计算的生成对象：既能表达属性耦合，也为后续约束注入与修复提供接口。

### 条件引导：把多源数据转为可学习的“生成条件”

本课题的数据条件并非作为事后评估，而是作为生成过程中持续的“引导信号”：

- **宏观约束（人口普查/统计年鉴）**：提供分区边际与部分联合统计，用作条件向量，确保生成总体在区域尺度与普查一致。  
- **空间锚定（建筑物/地块/POI）**：在建筑物尺度定义生成粒度，以建筑形态、用地、POI功能等作为条件，使个体空间落点与城市形态相容。  
- **时间动态（手机信令/夜间灯光等）**：以时段分布与活动强度作为条件，约束不同时间段的人口空间分布与动态变化。  

条件化的关键不是“加更多特征”，而是把多源信息统一成一组可解释、可控的生成条件，使评审能够清楚看到：**哪个数据约束了哪个生成维度。**

### 约束注入：软约束引导 + 硬约束投影/修复

人口合成的约束具有层次性：宏观统计允许误差（软约束），而逻辑与结构性零不可违反（硬约束）。对应地，本课题采用“引导 + 投影”的两段式机制，使扩散模型既可控又可行：

- **软约束（宏观统计）作为去噪引导**：将边际与关键联合统计差异写成可微目标，在采样过程中持续把生成分布拉回目标统计附近，使“宏观一致性”内生到生成动力学中。  
- **硬约束（规则/结构性零/层级一致性）通过投影/修复保证**：对生成个体进行规则检查（如年龄–就业逻辑、户规模一致性、结构性零），并在生成过程中（逐步或最终）执行投影与修复，确保样本落在可行域内。

这一设计把“扩散的生成能力”与“人口合成的可行域”显式耦合：软约束决定分布形状，硬约束定义可行边界，从而避免仅靠后处理导致的联合结构破坏。

### 验证闭环：把“真实性”写成可检验的指标

基金评审更关心“能否被检验”，而非模型名词的先进性。本课题的验证闭环围绕三类可检验对象展开：

- **统计一致性**：以“生成总体与普查数据在分区边际及关键二阶关联（收入–职业、居住地–就业地）上的差异 < X%”作为验收指标，直接度量联合关联结构的重建质量。  
- **空间真实性**：在建筑物尺度上，以人口落点与用地功能、POI活跃度、夜间灯光等空间证据的一致性为指标，度量“空间锚定”是否把个体位置限制在合理的城市形态中。  
- **时间真实性**：以日周期与周周期（通勤潮、昼夜差异、工作日/周末差异）的匹配程度为指标，度量模型对时空动态的重建质量。

上述验证指标直接对应“多源条件–受控生成”的闭环结构：若某一环失效，可定位到对应条件或约束机制并迭代修正，形成渐进式可收敛的研究路线。

> 延展性：该框架把宏观统计一致性、建筑物尺度空间锚定与时间动态约束统一进同一生成过程，为后续跨城市迁移与情景模拟提供可扩展的方法底座。

[^tabular-diff]: 代表性实现可参见 TabDDPM、STaSy、Multinomial diffusion、D3PM 等；正文强调设计逻辑而不展开具体变体。
